<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wheel of Names - Zen Mode (Mod)</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- GLOBAL RESET --- */
        * { box-sizing: border-box; outline: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            font-family: 'Roboto', sans-serif;
            background: radial-gradient(circle at center, #f0f4f8 0%, #dbe4ea 100%);
            color: #333;
            height: 100vh;
            display: flex; flex-direction: column;
            overflow: hidden; 
        }

        /* --- NAVBAR --- */
        header {
            height: 60px; background-color: #ffffff;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 50; flex-shrink: 0;
            transition: margin-top 0.3s ease;
        }
        header.hidden { margin-top: -60px; }

        .nav-brand { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 8px; color: #333; }
        .nav-brand span { color: #3c71eb; font-size: 22px; }
        
        .lang-select {
            background: #f8f9fa; color: #333; 
            border: 1px solid #ccc; 
            padding: 5px 8px; border-radius: 4px; cursor: pointer;
            font-size: 14px;
        }

        /* --- MAIN LAYOUT --- */
        .main-container {
            display: flex; flex: 1;
            height: calc(100vh - 60px);
            position: relative;
            overflow: hidden;
            transition: height 0.3s ease;
        }
        .main-container.fullscreen { height: 100vh; }

        /* --- CUSTOM TITLE --- */
        .title-wrapper {
            position: absolute; top: 20px; left: 30px; z-index: 40; display: flex; align-items: center; gap: 10px;
            transition: opacity 0.3s;
        }
        .title-wrapper.hidden { opacity: 0; pointer-events: none; }

        .custom-title {
            font-size: 32px; font-weight: 700; color: #333; 
            background: transparent; border: none;
            border-bottom: 2px dashed rgba(0,0,0,0.2); 
            padding-bottom: 5px; min-width: 250px;
        }
        .custom-title:focus { border-bottom: 2px solid #3c71eb; }
        .edit-icon { font-size: 20px; color: #888; }

        /* --- WHEEL SECTION --- */
        .wheel-section {
            flex: 1; display: flex; justify-content: center; align-items: center; position: relative;
            padding: 20px;
            transition: all 0.3s ease;
        }
        .wheel-stage {
            position: relative;
            width: 80vh; height: 80vh; 
            max-width: 80vw; max-height: 80vw;
            border-radius: 50%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            transition: width 0.3s, height 0.3s;
        }
        canvas { width: 100%; height: 100%; transform: rotate(0deg); border-radius: 50%; }

        /* VIGNETTE */
        .wheel-stage::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            border-radius: 50%; pointer-events: none;
            background: radial-gradient(circle, rgba(0,0,0,0) 60%, rgba(0,0,0,0.1) 85%, rgba(0,0,0,0.3) 100%);
            z-index: 5;
        }

        .center-hub {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 18%; height: 18%; background: white; border-radius: 50%;
            box-shadow: 0 0 15px rgba(0,0,0,0.2); z-index: 10;
        }

        .pointer {
            position: absolute; right: -12px; top: 50%; transform: translateY(-50%);
            width: 0; height: 0; 
            border-top: 25px solid transparent;
            border-bottom: 25px solid transparent;
            border-right: 50px solid #eeb41b; 
            filter: drop-shadow(-3px 4px 4px rgba(0,0,0,0.3));
            z-index: 20;
            transition: border-right-color 0.1s linear;
        }

        .text-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 15;
            animation: pulseText 2s infinite ease-in-out;
            transition: opacity 0.5s;
        }
        @keyframes pulseText { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        
        .curve-text {
            font-family: 'Roboto', sans-serif; font-weight: 900; font-size: 55px;
            fill: white; text-transform: uppercase;
            filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.5)); letter-spacing: 4px;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 400px; background-color: #ffffff; 
            box-shadow: -5px 0 25px rgba(0,0,0,0.05);
            z-index: 30; display: flex; flex-direction: column; padding: 20px;
            align-items: center; border-left: 1px solid #e0e0e0;
            transition: margin-right 0.3s ease, opacity 0.3s ease;
        }
        .sidebar.hidden {
            margin-right: -400px; opacity: 0; display: none;
        }

        .tabs { display: flex; width: 100%; border-bottom: 2px solid #eee; margin-bottom: 15px; }
        .tab-item { flex: 1; text-align: center; padding: 10px; cursor: pointer; color: #888; font-weight: 500; font-size: 14px; }
        .tab-item.active { color: #3c71eb; border-bottom: 3px solid #3c71eb; font-weight: 700; }

        .sidebar-content { width: 100%; display: none; flex-direction: column; align-items: center; flex-grow: 1; }
        .sidebar-content.active { display: flex; }

        .toolbar { display: flex; gap: 8px; margin-bottom: 10px; width: 100%; }
        .btn {
            border: none; border-radius: 8px; padding: 10px 8px; font-weight: 600; 
            cursor: pointer; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex: 1; text-align: center; display: flex; justify-content: center; align-items: center; font-size: 12px;
        }
        .btn-blue { background: #3c71eb; }
        .btn-blue:active { background: #3367d6; transform: translateY(1px); }
        .btn-red { background: #d81b30; flex: 0 0 auto; width: 100%; margin-top: 10px; border-radius: 8px;}

        /* Options Toggle inside sidebar */
        .options-toggle { width: 100%; text-align: right; margin-bottom: 5px; font-size: 12px; color: #3c71eb; cursor: pointer; font-weight: 600; user-select: none; }
        .options-toggle:hover { text-decoration: underline; }
        
        .options-box { background: #f8f9fa; border: 1px solid #eee; padding: 15px; border-radius: 12px;
            margin-bottom: 15px; display: flex; flex-direction: column; gap: 12px; width: 100%; align-items: center; overflow: hidden; transition: all 0.3s ease; max-height: 800px; opacity: 1; }
        .options-box.hidden-opt { margin-bottom: 0; padding: 0 15px; max-height: 0; opacity: 0; border: none; }
        
        .switch-container { display: flex; align-items: center; justify-content: space-between; width: 100%; font-size: 13px; color: #555; }
        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
        input:checked + .slider { background-color: #3c71eb; }
        input:checked + .slider:before { transform: translateX(20px); }
        
        .strength-label { font-size: 12px; color: #888; margin-bottom: 5px; display:block; }
        .speed-control { display: flex; gap: 3px; background: #e9ecef; padding: 4px; border-radius: 25px; width: 100%; justify-content: space-between; }
        .speed-opt { cursor: pointer; padding: 5px 0; border-radius: 20px; font-size: 10px; color: #666; text-align: center; flex: 1; transition: all 0.2s; white-space: nowrap; }
        .speed-opt.active { background: #3c71eb; color: white; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

        .input-wrapper { flex-grow: 1; width: 100%; background: #ffffff; border: 2px solid #e0e0e0; border-radius: 12px; overflow: hidden; display: flex; min-height: 150px; transition: min-height 0.3s; }
        .options-box.hidden-opt ~ .input-wrapper { min-height: 300px; }
        #nameInput { width: 100%; height: 100%; background: transparent; border: none; color: #333; padding: 15px; font-size: 14px; font-family: 'Roboto', sans-serif; resize: none; line-height: 1.6; text-align: left; }

        .results-list { width: 100%; flex-grow: 1; overflow-y: auto; background: #ffffff; border: 2px solid #e0e0e0; border-radius: 12px; padding: 15px; margin-bottom: 15px; text-align: left; min-height: 200px; }
        .result-item { padding: 8px 0; border-bottom: 1px solid #eee; color: #333; font-size: 14px; }

        /* --- FLOATING MENU BUTTON --- */
        .fab-toggle {
            position: fixed; bottom: 25px; right: 25px;
            width: 55px; height: 55px;
            background-color: #3c71eb; color: white;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 24px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            cursor: pointer; z-index: 200;
            transition: transform 0.2s, background-color 0.2s;
        }
        .fab-toggle:hover { transform: scale(1.1); background-color: #3367d6; }
        .fab-toggle:active { transform: scale(0.9); }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 100; justify-content: center; align-items: center; padding: 20px; }
        .modal-content { background: #ffffff; color: #333; padding: 30px 20px; border-radius: 20px; text-align: center; width: 100%; max-width: 450px; animation: popIn 0.3s ease; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        @keyframes popIn { from {transform: scale(0.8); opacity:0;} to {transform: scale(1); opacity:1;} }
        .winner-name { font-size: 3rem; font-weight: 900; color: #3c71eb; margin: 10px 0 20px 0; word-wrap: break-word; line-height: 1.1; }

        /* RESPONSIVE */
        @media screen and (max-width: 768px) {
            body { height: auto; overflow-y: auto; }
            .main-container { flex-direction: column; height: auto; overflow: visible; }
            .main-container.fullscreen { height: 100vh; overflow: hidden; justify-content: center;}
            .title-wrapper { position: relative; top: 0; left: 0; width: 100%; justify-content: center; margin-top: 15px; padding: 0 15px; }
            .custom-title { text-align: center; font-size: 24px; width: 100%; min-width: auto; }
            .wheel-section { padding: 10px 0 30px 0; min-height: auto; }
            .wheel-stage { width: 90vw; height: 90vw; max-width: 400px; max-height: 400px; }
            .sidebar { width: 100%; height: auto; box-shadow: none; border-left: none; border-top: 1px solid #e0e0e0; padding: 20px 15px; }
            .sidebar.hidden { margin-right: 0; margin-bottom: -1000px; display: none; }
            .input-wrapper, .results-list { min-height: 250px; }
            .modal-content { padding: 30px 15px; }
            .winner-name { font-size: 2.5rem; }
        }
    </style>
</head>
<body>

    <header id="mainHeader">
        <div class="nav-brand"><span>●</span> Wheel</div>
        <select id="langSel" class="lang-select" onchange="changeLanguage(this.value)">
            <option value="en">English</option>
            <option value="id">Indonesia</option>
        </select>
    </header>

    <div class="main-container" id="mainContainer">
        <div class="title-wrapper" id="titleWrapper">
            <input type="text" class="custom-title" value="My Lucky Wheel">
            <span class="edit-icon">✎</span>
        </div>

        <div class="wheel-section" id="wheelZone">
            <div class="wheel-stage">
                <canvas id="wheelCanvas"></canvas>
                <div class="center-hub"></div>
                <div class="pointer" id="pointerArrow"></div>
                
                <svg class="text-overlay" viewBox="0 0 500 500" id="spinTextOverlay">
                    <path id="textCurve" d="M 125,250 A 125,125 0 1,1 375,250" fill="none"/>
                    <text class="curve-text" width="500">
                        <textPath xlink:href="#textCurve" startOffset="50%" text-anchor="middle" id="txtPathClick">CLICK TO SPIN</textPath>
                    </text>
                    <text x="50%" y="60%" text-anchor="middle" fill="white" font-size="20" font-weight="bold" style="filter: drop-shadow(1px 1px 2px black);" id="txtSubClick">TAP or press ctrl+enter</text>
                </svg>
            </div>
        </div>

        <div class="sidebar" id="sidebarPanel">
            <div class="tabs">
                <div class="tab-item active" onclick="switchTab('entries')" id="tabEntries">Entries</div>
                <div class="tab-item" onclick="switchTab('results')" id="tabResults">Results</div>
            </div>

            <div id="entries-content" class="sidebar-content active">
                <div class="toolbar">
                    <button class="btn btn-blue" onclick="shuffleNames()" id="btnShuffle">Shuffle</button>
                    <button class="btn btn-blue" onclick="sortNames()" id="btnSort">Sort A-Z</button>
                    <button class="btn btn-blue" onclick="sortNamesZA()" id="btnSortZA">Sort Z-A</button>
                </div>

                <div class="options-toggle" onclick="toggleOptionsBox()">
                    <span id="txtToggleOptions">▼ Hide Options</span>
                </div>

                <div class="options-box" id="optionsBox">
                    <div class="switch-container">
                        <span id="lblRemove">Remove after win</span>
                        <label class="switch"><input type="checkbox" id="chkRemove"><span class="slider"></span></label>
                    </div>
                    <div class="switch-container">
                        <span id="lblPopup">Show winner popup</span>
                        <label class="switch"><input type="checkbox" checked id="chkPopup"><span class="slider"></span></label>
                    </div>
                    
                    <div style="width: 100%; text-align: center; margin-top: 5px;">
                        <span class="strength-label" id="lblStrength">Spin Strength</span>
                        <div class="speed-control">
                            <div class="speed-opt" onclick="setStrength(0.5, this)" id="strLow">Low</div>
                            <div class="speed-opt" onclick="setStrength(0.8, this)" id="strMed">Medium</div>
                            <div class="speed-opt active" onclick="setStrength(1.0, this)" id="strNorm">Normal</div>
                            <div class="speed-opt" onclick="setStrength(1.3, this)" id="strFast">Fast</div>
                            <div class="speed-opt" onclick="setStrength(1.8, this)" id="strVFast">V.Fast</div>
                        </div>
                    </div>

                    <div id="cheatControls" style="display: none; width: 100%; flex-direction: column; gap: 10px; margin-top: 15px; border-top: 2px dashed #d81b30; padding-top: 10px;">
                        <div style="color: #d81b30; font-weight: bold; font-size: 12px; text-align: center;">⚠ ADMIN CHEAT MODE ⚠</div>
                        
                        <div class="switch-container">
                            <span>Enable Cheat</span>
                            <label class="switch"><input type="checkbox" id="chkCheatActive"><span class="slider" style="background-color: #d81b30;"></span></label>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; width: 100%;">
                            <span style="font-size: 11px; color: #666; margin-bottom: 3px;">Force Winner:</span>
                            <select id="selCheatWinner" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc; width: 100%;">
                                </select>
                        </div>
                    </div>
                    </div>

                <div class="input-wrapper">
                     <textarea id="nameInput" spellcheck="false" placeholder="Type names here...">Ali
Beatriz
Charles
Diya
Eric
Fatima
Hanna</textarea>
                </div>
            </div>

            <div id="results-content" class="sidebar-content">
                <div class="results-list" id="resultsListContainer">
                    <div style="color:#888; font-style:italic; text-align:center;" id="txtNoRes">No results yet.</div>
                </div>
                <button class="btn btn-red" onclick="clearResults()" id="btnClear">Clear Results</button>
            </div>
        </div>
    </div>

    <div class="fab-toggle" onclick="toggleFullscreen()" title="Toggle Sidebar">
        <span id="iconFab">✕</span>
    </div>

    <div class="modal" id="winnerModal">
        <div class="modal-content">
            <h2 style="color:#888; margin:0;" id="txtWeHaveWinner">We have a winner!</h2>
            <div class="winner-name" id="winnerText">WINNER</div>
            <button class="btn btn-blue" onclick="closeModal()" id="btnClose">Close</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const inputArea = document.getElementById('nameInput');
        const pointerArrow = document.getElementById('pointerArrow');
        const overlaySVG = document.getElementById('spinTextOverlay');
        const wheelZone = document.getElementById('wheelZone');

        const palette = ['#3c71eb', '#d81b30', '#eeb41b', '#0b9d2e']; 
        
        let colors = [];
        let names = [];
        let results = [];
        let currentAngle = 0;
        let isSpinning = false;
        let isIdle = true; 
        let spinVelocity = 0;
        let speedMult = 1.0;
        
        // Toggle States
        let isOptionsBoxVisible = true;
        let isSidebarVisible = true;

        const langData = {
            en: {
                tabEntries: "Entries", tabResults: "Results", btnShuffle: "Shuffle", btnSort: "Sort A-Z", btnSortZA: "Sort Z-A",
                lblRemove: "Remove after win", lblPopup: "Show winner popup", lblStrength: "Spin Strength",
                strLow: "Low", strMed: "Medium", strNorm: "Normal", strFast: "Fast", strVFast: "V.Fast",
                txtNoRes: "No results yet.", btnClear: "Clear Results", txtWeHaveWinner: "We have a winner!",
                btnClose: "Close", txtPathClick: "CLICK TO SPIN", txtSubClick: "TAP or press ctrl+enter",
                txtHideOpt: "▼ Hide Options", txtShowOpt: "▶ Show Options"
            },
            id: {
                tabEntries: "Entri", tabResults: "Hasil", btnShuffle: "Acak", btnSort: "Urutkan A-Z", btnSortZA: "Urutkan Z-A",
                lblRemove: "Hapus setelah menang", lblPopup: "Tampilkan popup", lblStrength: "Kekuatan Putar",
                strLow: "Lemah", strMed: "Sedang", strNorm: "Normal", strFast: "Cepat", strVFast: "Sgt Cepat",
                txtNoRes: "Belum ada hasil.", btnClear: "Hapus Hasil", txtWeHaveWinner: "Pemenangnya adalah!",
                btnClose: "Tutup", txtPathClick: "KLIK UNTUK PUTAR", txtSubClick: "KETUK atau tekan ctrl+enter",
                txtHideOpt: "▼ Sembunyikan Opsi", txtShowOpt: "▶ Tampilkan Opsi"
            }
        };

        function init() {
            resizeCanvas();
            updateNames();
            window.addEventListener('resize', resizeCanvas);
            inputArea.addEventListener('input', updateNames);
            wheelZone.addEventListener('click', startSpin);
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') startSpin();
            });

            // --- [START] EVENT LISTENER UNTUK MEMBUKA CHEAT (HOLD 3 DETIK) ---
            const toggleBtn = document.querySelector('.options-toggle');
            let pressTimer;

            function startPressTimer() {
                pressTimer = setTimeout(() => {
                    const cheatPanel = document.getElementById('cheatControls');
                    // Toggle visibility
                    if(cheatPanel.style.display === 'none') {
                        cheatPanel.style.display = 'flex';
                        updateCheatDropdown(); 
                        alert("⚠ ADMIN CHEAT MODE ENABLED");
                    } else {
                        cheatPanel.style.display = 'none';
                    }
                }, 3000); // 3 detik
            }

            function clearPressTimer() {
                clearTimeout(pressTimer);
            }

            // Mouse events
            toggleBtn.addEventListener('mousedown', startPressTimer);
            toggleBtn.addEventListener('mouseup', clearPressTimer);
            toggleBtn.addEventListener('mouseleave', clearPressTimer);
            // Touch events (untuk HP)
            toggleBtn.addEventListener('touchstart', startPressTimer);
            toggleBtn.addEventListener('touchend', clearPressTimer);
            // --- [END] EVENT LISTENER CHEAT ---

            requestAnimationFrame(loop);
        }

        // --- FULLSCREEN TOGGLE (SIDEBAR HIDER) ---
        function toggleFullscreen() {
            const sidebar = document.getElementById('sidebarPanel');
            const mainContainer = document.getElementById('mainContainer');
            const header = document.getElementById('mainHeader');
            const title = document.getElementById('titleWrapper');
            const fabIcon = document.getElementById('iconFab');
            
            isSidebarVisible = !isSidebarVisible;
            if (isSidebarVisible) {
                sidebar.classList.remove('hidden');
                mainContainer.classList.remove('fullscreen');
                header.classList.remove('hidden');
                title.classList.remove('hidden');
                fabIcon.innerText = "✕"; 
            } else {
                sidebar.classList.add('hidden');
                mainContainer.classList.add('fullscreen');
                header.classList.add('hidden');
                title.classList.add('hidden');
                fabIcon.innerText = "☰"; 
            }
            setTimeout(resizeCanvas, 350);
        }

        // --- INTERNAL OPTIONS TOGGLE ---
        function toggleOptionsBox() {
            const box = document.getElementById('optionsBox');
            isOptionsBoxVisible = !isOptionsBoxVisible;
            if (isOptionsBoxVisible) {
                box.classList.remove('hidden-opt');
            } else {
                box.classList.add('hidden-opt');
            }
            updateToggleText();
        }

        function updateToggleText() {
            const lang = document.getElementById('langSel').value;
            const d = langData[lang];
            const txt = document.getElementById('txtToggleOptions');
            txt.innerText = isOptionsBoxVisible ? d.txtHideOpt : d.txtShowOpt;
        }

        function updateNames() {
            names = inputArea.value.split('\n').filter(n => n.trim() !== '');
            generateSegmentColors();
            updateCheatDropdown(); // Update list cheat saat nama berubah
        }

        // --- [START] FUNGSI UPDATE DROPDOWN CHEAT ---
        function updateCheatDropdown() {
            const sel = document.getElementById('selCheatWinner');
            if(!sel) return;
            const currentVal = sel.value;
            sel.innerHTML = '';
            
            names.forEach(name => {
                const opt = document.createElement('option');
                opt.value = name;
                opt.innerText = name;
                sel.appendChild(opt);
            });

            if (names.includes(currentVal)) {
                sel.value = currentVal;
            }
        }
        // --- [END] FUNGSI CHEAT ---

        function generateSegmentColors() {
            colors = [];
            if (names.length === 0) return;

            for (let i = 0; i < names.length; i++) {
                let color = palette[i % palette.length];
                if (i === names.length - 1 && names.length > 1) {
                    if (color === colors[0]) {
                        for (let p of palette) {
                            if (p !== colors[0] && p !== colors[i-1]) {
                                color = p;
                                break;
                            }
                        }
                    }
                }
                colors.push(color);
            }
        }

        function resizeCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
        }

        function drawWheel() {
            const width = canvas.width / (window.devicePixelRatio || 1);
            const height = canvas.height / (window.devicePixelRatio || 1);
            const cx = width / 2;
            const cy = height / 2;
            const radius = width / 2; 

            ctx.clearRect(0, 0, width, height);
            
            if (names.length === 0) return;
            const sliceAngle = (2 * Math.PI) / names.length;
            const fontSize = radius / 10;
            for (let i = 0; i < names.length; i++) {
                const startAngle = currentAngle + (i * sliceAngle);
                const endAngle = startAngle + sliceAngle;

                ctx.beginPath();
                ctx.moveTo(cx, cy);
                ctx.arc(cx, cy, radius, startAngle, endAngle);
                ctx.fillStyle = colors[i];
                ctx.fill();
                ctx.strokeStyle = "rgba(0,0,0,0.1)";
                ctx.lineWidth = 1;
                ctx.stroke();

                ctx.save();
                ctx.translate(cx, cy);
                ctx.rotate(startAngle + sliceAngle / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "white"; 
                ctx.font = "bold " + fontSize + "px Arial";
                ctx.shadowColor = "rgba(0,0,0,0.4)";
                ctx.shadowBlur = 4;
                ctx.fillText(names[i], radius - 20, fontSize / 3);
                ctx.restore();
            }
        }

        function updatePointerColor() {
            if (names.length === 0) return;
            const sliceAngle = (2 * Math.PI) / names.length;
            let normAngle = currentAngle % (2 * Math.PI);
            if (normAngle < 0) normAngle += 2 * Math.PI;
            let effectiveAngle = (2 * Math.PI) - normAngle;
            let index = Math.floor(effectiveAngle / sliceAngle) % names.length;
            
            if (colors[index]) {
                pointerArrow.style.borderRightColor = colors[index];
            }
        }

        function loop() {
            if (isIdle) {
                currentAngle += 0.002;
            } 
            else if (isSpinning) {
                currentAngle += spinVelocity;
                spinVelocity *= 0.985; 

                if (spinVelocity < 0.001) {
                    isSpinning = false;
                    isIdle = false; 
                    handleWin();
                }
            }
            drawWheel();
            updatePointerColor(); 
            requestAnimationFrame(loop);
        }

        function startSpin() {
            if (isSpinning || names.length < 1) return;
            
            isIdle = false;
            isSpinning = true;

            // --- [START] LOGIKA CHEAT ---
            const cheatActive = document.getElementById('chkCheatActive').checked;
            const cheatWinner = document.getElementById('selCheatWinner').value;
            
            // Cek apakah cheat aktif dan nama pemenang ada di daftar
            if (cheatActive && cheatWinner && names.includes(cheatWinner)) {
                
                const winnerIndex = names.indexOf(cheatWinner);
                const sliceAngle = (2 * Math.PI) / names.length;
                
                // RandomOffset 0.2 s/d 0.8 agar jarum tidak selalu berhenti tepat di tengah (biar natural)
                const randomOffset = 0.2 + Math.random() * 0.6; 
                
                // Sudut absolut target pada putaran lingkaran (0 - 2PI)
                let targetAngleLocal = (2 * Math.PI) - ((winnerIndex + randomOffset) * sliceAngle);
                
                // Normalisasi sudut saat ini
                let currentAngleNormalized = currentAngle % (2 * Math.PI);
                if (currentAngleNormalized < 0) currentAngleNormalized += 2 * Math.PI;

                // Hitung jarak yang harus ditempuh
                let distanceToTarget = targetAngleLocal - currentAngleNormalized;
                if (distanceToTarget < 0) distanceToTarget += (2 * Math.PI);

                // Tambahkan minimal 5 putaran penuh agar terlihat berputar kencang
                const extraSpins = 5 * (2 * Math.PI);
                const totalDistance = distanceToTarget + extraSpins;

                // --- FISIKA MUNDUR ---
                // V_awal = Distance * (1 - decay). Decay = 0.985
                spinVelocity = totalDistance * (1 - 0.985);

            } else {
                // SPIN NORMAL (RANDOM)
                spinVelocity = (Math.random() * 0.3 + 0.4) * speedMult;
            }
            // --- [END] LOGIKA CHEAT ---

            overlaySVG.style.opacity = '0';
            setTimeout(() => overlaySVG.style.display = 'none', 500);
        }

        function handleWin() {
            const sliceAngle = (2 * Math.PI) / names.length;
            let normAngle = currentAngle % (2 * Math.PI);
            if (normAngle < 0) normAngle += 2 * Math.PI;
            let effectiveAngle = (2 * Math.PI) - normAngle;
            let index = Math.floor(effectiveAngle / sliceAngle) % names.length;
            
            const winner = names[index];
            results.push(winner);
            updateResults();

            if (document.getElementById('chkPopup').checked) {
                document.getElementById('winnerText').innerText = winner;
                document.getElementById('winnerText').style.color = colors[index]; 
                document.getElementById('winnerModal').style.display = 'flex';
            } else {
                finalizeWin(winner);
            }
        }

        function closeModal() {
            document.getElementById('winnerModal').style.display = 'none';
            finalizeWin(document.getElementById('winnerText').innerText);
        }

        function finalizeWin(name) {
            if (document.getElementById('chkRemove').checked) {
                const idx = names.indexOf(name);
                if (idx !== -1) {
                    names.splice(idx, 1);
                    inputArea.value = names.join('\n');
                    updateNames();
                }
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-item').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.sidebar-content').forEach(el => el.classList.remove('active'));
            if(tab === 'entries') {
                document.getElementById('tabEntries').classList.add('active');
                document.getElementById('entries-content').classList.add('active');
            } else {
                document.getElementById('tabResults').classList.add('active');
                document.getElementById('results-content').classList.add('active');
            }
        }

        function updateResults() {
            const list = document.getElementById('resultsListContainer');
            const noResText = document.getElementById('langSel').value === 'en' ? "No results yet." : "Belum ada hasil.";
            list.innerHTML = '';
            if(results.length === 0) {
                list.innerHTML = `<div style="color:#888; font-style:italic; text-align:center;" id="txtNoRes">${noResText}</div>`;
                return;
            }
            [...results].reverse().forEach((r, i) => {
                const div = document.createElement('div');
                div.className = 'result-item';
                div.innerText = `#${results.length - i} ${r}`;
                list.appendChild(div);
            });
        }

        function clearResults() { results = []; updateResults(); }
        
        function shuffleNames() { 
            names.sort(() => Math.random() - 0.5);
            inputArea.value = names.join('\n'); 
            generateSegmentColors(); 
            updateCheatDropdown();
        }
        function sortNames() { 
            names.sort();
            inputArea.value = names.join('\n'); 
            generateSegmentColors(); 
            updateCheatDropdown();
        }
        function sortNamesZA() { 
            names.sort((a, b) => b.localeCompare(a));
            inputArea.value = names.join('\n'); 
            generateSegmentColors(); 
            updateCheatDropdown();
        }
        
        function setStrength(v, el) { 
            speedMult = v;
            document.querySelectorAll('.speed-opt').forEach(e => e.classList.remove('active'));
            el.classList.add('active');
        }

        function changeLanguage(lang) {
            const d = langData[lang];
            document.getElementById('tabEntries').innerText = d.tabEntries;
            document.getElementById('tabResults').innerText = d.tabResults;
            document.getElementById('btnShuffle').innerText = d.btnShuffle;
            document.getElementById('btnSort').innerText = d.btnSort;
            document.getElementById('btnSortZA').innerText = d.btnSortZA;
            document.getElementById('lblRemove').innerText = d.lblRemove;
            document.getElementById('lblPopup').innerText = d.lblPopup;
            document.getElementById('lblStrength').innerText = d.lblStrength;
            document.getElementById('strLow').innerText = d.strLow;
            document.getElementById('strMed').innerText = d.strMed;
            document.getElementById('strNorm').innerText = d.strNorm;
            document.getElementById('strFast').innerText = d.strFast;
            document.getElementById('strVFast').innerText = d.strVFast;
            document.getElementById('btnClear').innerText = d.btnClear;
            document.getElementById('txtWeHaveWinner').innerText = d.txtWeHaveWinner;
            document.getElementById('btnClose').innerText = d.btnClose;
            document.getElementById('txtPathClick').textContent = d.txtPathClick;
            document.getElementById('txtSubClick').textContent = d.txtSubClick;
            
            updateToggleText();
            if(results.length === 0) document.getElementById('txtNoRes').innerText = d.txtNoRes;
        }

        init();
    </script>
</body>
</html>
